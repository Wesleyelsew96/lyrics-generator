<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lyrics Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&family=Manrope:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #05080f;
      --panel: #0f1725;
      --border: #1f2a3d;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --accent: #5eead4;
      --accent-2: #a855f7;
      --shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Manrope", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at 15% 20%, rgba(94, 234, 212, 0.08), transparent 30%),
                  radial-gradient(circle at 80% 0%, rgba(168, 85, 247, 0.1), transparent 30%),
                  var(--bg);
      color: var(--text);
      padding: 32px 18px 48px;
    }
    .page {
      max-width: 1040px;
      margin: 0 auto;
    }
    .page-header {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 22px;
    }
    h1 {
      font-family: "Space Grotesk", "Manrope", sans-serif;
      font-size: 32px;
      margin: 4px 0 6px;
    }
    h2 {
      font-family: "Space Grotesk", "Manrope", sans-serif;
      font-size: 22px;
      margin: 0 0 10px;
    }
    p { margin: 0; }
    .eyebrow {
      font-size: 13px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .muted { color: var(--muted); }
    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .button {
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 10px;
      text-decoration: none;
      font-weight: 600;
      display: inline-flex;
      gap: 8px;
      align-items: center;
      transition: transform 120ms ease, border-color 120ms ease;
    }
    .button:hover { transform: translateY(-1px); border-color: var(--accent); }
    .button.primary { background: linear-gradient(135deg, var(--accent), var(--accent-2)); border: none; color: #0b1020; }
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: rgba(94, 234, 212, 0.1);
      border: 1px solid rgba(94, 234, 212, 0.25);
      border-radius: 999px;
      color: var(--text);
      font-size: 13px;
    }
    .grid {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    }
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px 18px 18px;
      box-shadow: var(--shadow);
    }
    form { display: grid; gap: 12px; }
    label { display: grid; gap: 6px; font-weight: 600; color: var(--text); }
    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #0b1020;
      color: var(--text);
      font-size: 15px;
      font-family: "Manrope", sans-serif;
    }
    textarea { min-height: 110px; resize: vertical; }
    .helper { font-size: 13px; color: var(--muted); }
    .output {
      background: linear-gradient(135deg, rgba(94, 234, 212, 0.06), rgba(168, 85, 247, 0.05)), var(--panel);
    }
    pre {
      white-space: pre-wrap;
      background: #050910;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      margin: 12px 0 0;
      font-family: "Space Grotesk", monospace;
      color: var(--text);
      min-height: 170px;
    }
    @media (max-width: 640px) {
      body { padding: 22px 14px 32px; }
      .page-header { align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="page-header">
      <div>
        <p class="eyebrow">Prototype UI</p>
        <h1>Lyrics Generator</h1>
        <p class="muted">Enter a theme, genre, mood, and verse count to preview placeholder lyrics. Replace the mock generator with your model call when ready.</p>
      </div>
      <div class="actions">
        <a class="button" href="../">Back to repo</a>
        <a class="button" href="https://github.com/Wesleyelsew96/lyrics-generator" target="_blank" rel="noreferrer">GitHub</a>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <div class="chip">Input</div>
        <h2>Compose a prompt</h2>
        <p class="muted">Send a request to your backend and preview the returned chorus. Update the endpoint in the script when you deploy.</p>
        <form id="lyrics-form">
          <label>
            Title
            <input type="text" name="title" placeholder="Midnight Carousel" required>
          </label>
          <label>
            BPM (optional)
            <input type="number" name="bpm" placeholder="118" min="30" max="300">
            <span class="helper">Only used when provided; ignored otherwise.</span>
          </label>
          <label>
            Max new tokens
            <input type="number" name="max_new_tokens" min="16" max="256" value="80">
          </label>
          <label>
            Temperature
            <input type="number" name="temperature" min="0" max="2" step="0.1" value="1.0">
          </label>
          <label>
            Top-p
            <input type="number" name="top_p" min="0" max="1" step="0.05" value="0.9">
          </label>
          <label>
            Top-k
            <input type="number" name="top_k" min="0" max="200" step="1" value="50">
          </label>
          <label>
            Number of samples
            <input type="number" name="num_return_sequences" min="1" max="5" value="1">
            <span class="helper">Returns multiple variations if supported by the backend.</span>
          </label>
          <button class="button primary" type="submit">Generate chorus</button>
        </form>
      </section>

      <section class="card output">
        <div class="chip">Output</div>
        <h2>Generated lyrics</h2>
        <p class="muted">Calls your backend endpoint and displays the response with title/BPM context.</p>
        <p id="output-meta" class="muted"></p>
        <p id="output-status" class="helper"></p>
        <pre id="lyrics-output">Waiting for input.</pre>
      </section>
    </div>
  </div>

  <script>
    const API_URL = "/api/generate"; // Update to your deployed endpoint
    const form = document.getElementById("lyrics-form");
    const output = document.getElementById("lyrics-output");
    const meta = document.getElementById("output-meta");
    const statusEl = document.getElementById("output-status");

    const normalizeEntry = (entry) => {
      if (!entry) return "";
      if (typeof entry === "string") return entry;
      if (entry.text) return entry.text;
      if (entry.generated_text) return entry.generated_text;
      if (entry.output) return entry.output;
      if (entry.message?.content) return entry.message.content;
      return "";
    };

    const extractOutputs = (data) => {
      if (!data) return [];
      if (Array.isArray(data.outputs)) return data.outputs.map(normalizeEntry).filter(Boolean);
      if (Array.isArray(data.generations)) return data.generations.map(normalizeEntry).filter(Boolean);
      if (Array.isArray(data.choices)) return data.choices.map((c) => normalizeEntry(c) || normalizeEntry(c.text)).filter(Boolean);
      if (typeof data.text === "string") return [data.text];
      if (typeof data.output === "string") return [data.output];
      return [];
    };

    const formatMeta = (title, bpm) => {
      if (!title && !bpm) return "";
      const parts = [];
      if (title) parts.push(`Title: ${title}`);
      if (bpm) parts.push(`BPM: ${bpm}`);
      return parts.join(" • ");
    };

    form?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const title = (formData.get("title") || "").toString().trim();
      const bpmRaw = (formData.get("bpm") || "").toString().trim();
      const bpm = bpmRaw ? Number(bpmRaw) : null;
      const maxNewTokens = Number(formData.get("max_new_tokens")) || 80;
      const temperature = Number(formData.get("temperature")) || 1.0;
      const topP = Number(formData.get("top_p")) || 0.9;
      const topK = Number(formData.get("top_k")) || 50;
      const numReturnSequences = Number(formData.get("num_return_sequences")) || 1;

      if (!title) {
        statusEl.textContent = "Add a title to generate lyrics.";
        output.textContent = "Waiting for input.";
        meta.textContent = "";
        return;
      }

      meta.textContent = formatMeta(title, bpm);
      statusEl.textContent = "Generating...";
      output.textContent = "Awaiting backend response...";

      const payload = {
        title,
        max_new_tokens: maxNewTokens,
        temperature,
        top_p: topP,
        top_k: topK,
        num_return_sequences: numReturnSequences,
      };
      if (bpm && Number.isFinite(bpm)) {
        payload.bpm = bpm;
      }

      try {
        const resp = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });
        if (!resp.ok) {
          throw new Error(`HTTP ${resp.status}`);
        }
        const data = await resp.json();
        const outputs = extractOutputs(data);
        if (!outputs.length) {
          throw new Error("Backend returned no text");
        }
        const formatted = outputs
          .map((text, idx) => `[${idx + 1}] ${text.trim() || "(empty)"}`)
          .join("\n\n");
        output.textContent = formatted;
        statusEl.textContent = `Success • ${outputs.length} sample${outputs.length > 1 ? "s" : ""}`;
      } catch (err) {
        const message = err instanceof Error ? err.message : "Unknown error";
        statusEl.textContent = `Error: ${message}`;
        output.textContent = "Could not fetch lyrics. Ensure your /api/generate endpoint is running.";
      }
    });
  </script>
</body>
</html>
